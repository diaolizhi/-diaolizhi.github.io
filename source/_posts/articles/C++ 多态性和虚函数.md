---
title: C++ å¤šæ€æ€§å’Œè™šå‡½æ•°
date: 2017-10-15
categories: C++
---

é¢å‘å¯¹è±¡åˆä¸€å¤§ç‰¹å¾
<!--more-->
# ä¸€. ä»€ä¹ˆæ˜¯å¤šæ€
åœ¨ C++ ä¸­, å‘ç”Ÿç»§æ‰¿å…³ç³»ä¹‹å, å­ç±»å¯¹è±¡èµ‹ç»™çˆ¶ç±»æŒ‡é’ˆæˆ–å¼•ç”¨, é€šè¿‡çˆ¶ç±»æŒ‡é’ˆæˆ–è€…å¼•ç”¨è°ƒç”¨æŸä¸ªæ–¹æ³•, æ ¹æ®å­ç±»å¯¹è±¡çš„ä¸åŒè€Œä½“ç°å‡ºä¸åŒçš„æ•ˆæœ.

# äºŒ. æ€ä¹ˆå®ç°å¤šæ€
- å­ç±»ç»§æ‰¿çˆ¶ç±»
- çˆ¶ç±»ä¸­å®šä¹‰çš„å‡½æ•°æ˜¯è™šå‡½æ•°
- å°†å­ç±»å¯¹è±¡èµ‹ç»™çˆ¶ç±»æŒ‡é’ˆæˆ–è€…å¼•ç”¨
- é€šè¿‡çˆ¶ç±»æŒ‡é’ˆæˆ–å¼•ç”¨è°ƒç”¨å‡½æ•°

# ä¸‰. ä»€ä¹ˆæ˜¯è™šå‡½æ•°

## - æ ¼å¼
```c++
virtual <è¿”å›å€¼ç±»å‹> <å‡½æ•°å>(<å½¢å¼å‚æ•°è¡¨>)
{
    <å‡½æ•°ä½“>
}
```
## - ä½œç”¨
è™šå‡½æ•°æ˜¯å®ç°å¤šæ€çš„åŸºç¡€
*å¦‚æœä¸ä½¿ç”¨è™šå‡½æ•°, é‚£ä¹ˆå°±ç®—çˆ¶ç±»æŒ‡é’ˆæˆ–è€…å¼•ç”¨æ¥æ”¶äº†å­ç±»å¯¹è±¡, å½“è°ƒç”¨æŸä¸ªæ–¹æ³•çš„æ—¶å€™, è°ƒç”¨çš„è¿˜æ˜¯çˆ¶ç±»ä¸­å®šä¹‰é‚£ä¸ªå‡½æ•°.*

åé¢ä¾‹å­
```c++
#include <iostream>

const double PI = 3.14;

using namespace std;

/*
2017å¹´10æœˆ14æ—¥ 11:23:36
é™æ€è”ç¼–çš„é—®é¢˜
è¾“å‡ºç»“æœ:
    Figue çš„é¢ç§¯æ˜¯:0
    Circle çš„é¢ç§¯æ˜¯:0
    Rectangle çš„é¢ç§¯æ˜¯:0
æ€è·¯:
    å­ç±»éƒ½å±äºçˆ¶ç±», é€šè¿‡è°ƒç”¨æŠŠå­ç±»çš„å¯¹è±¡èµ‹ç»™çˆ¶ç±»çš„å¼•ç”¨, ç„¶åç”±çˆ¶ç±»çš„å¼•ç”¨è°ƒç”¨å‡½æ•°å®ç°å¤šæ€.
    ä½†æ˜¯è¿™æ ·æ˜¯é”™è¯¯çš„, è¿™æ ·è°ƒç”¨çš„ä»ç„¶æ˜¯çˆ¶ç±»ä¸­çš„å‡½æ•°.
*/

class Figue
{
public:
    Figue(){};
    double area() const {return 0.0;}
};


class Circle: public Figue
{
public:
    Circle(double myr) {R = myr;}
    double area() const {return PI*R*R;} 
protected:
    double R;
};


class Rectangle: public Figue
{
public:
    Rectangle(double myl, double myw){L = myl; W = myw;}
    double area() const {return L*W;}
private:
    double L, W;
};

void func(Figue &p)
{
    cout<<p.area()<<endl;
}

int main()
{
    Figue fig;
    cout<<"Figue çš„é¢ç§¯æ˜¯:";
    func(fig);
    Circle c(3.0);
    cout<<"Circle çš„é¢ç§¯æ˜¯:";
    func(c);
    Rectangle r(4.0, 5.0);
    cout<<"Rectangle çš„é¢ç§¯æ˜¯:";
    func(r);

    return 0;
}
```

æ­£é¢ä¾‹å­
```c++

#include <iostream>

const double PI = 3.14;

/*
2017å¹´10æœˆ14æ—¥ 11:23:21
åŠ¨æ€è”ç¼–çš„ä¾‹å­
è¾“å‡ºç»“æœ:
    Figue çš„é¢ç§¯æ˜¯:0
    Circle çš„é¢ç§¯æ˜¯:28.26
    Rectangle çš„é¢ç§¯æ˜¯:20
åŸºç±»ä¸­çš„ area å‡½æ•°å®šä¹‰ä¸ºè™šå‡½æ•°
å­ç±»ä¸­è¦†ç›–(ä¸ºäº†åŒºåˆ†é‡è½½å‡½æ•°, æ‰€ä»¥ç§°ä¹‹ä¸ºè¦†ç›–)äº†è™šå‡½æ•°
ç„¶åæŠŠå­ç±»å¯¹è±¡èµ‹ç»™çˆ¶ç±»å¼•ç”¨, é€šè¿‡çˆ¶ç±»å¼•ç”¨(é€šè¿‡æŒ‡é’ˆä¹Ÿè¡Œ)è°ƒç”¨ area å®ç°è°ƒç”¨ä¸åŒå­ç±»çš„ area æ–¹æ³•
(å¤šæ€å°±æ˜¯é€šè¿‡çˆ¶ç±»è°ƒç”¨æ–¹æ³•ä½“ç°å‡ºæ¥çš„???)
*/

using namespace std;

class Figue
{
public:
    Figue(){};
    virtual double area() {return 0.0;}//å®šä¹‰ä¸ºè™šå‡½æ•°
};


class Circle: public Figue
{
public:
    Circle(){};
    Circle(double myr) {R = myr;}//å®šä¹‰ä¸ºè™šå‡½æ•°
    virtual double area() {return PI*R*R;}
protected:
    double R;
};


class Rectangle: public Circle
{
public:
    Rectangle(double myl, double myw) {L = myl; W = myw;}
    virtual double area() {return L*W;}
private:
    double L, W;
};

void func(Figue &p)
{
    cout<<p.area()<<endl;
}

int main()
{
    Figue fig;
    cout<<"Figue çš„é¢ç§¯æ˜¯:";
    func(fig);
    Circle c(3.0);
    cout<<"Circle çš„é¢ç§¯æ˜¯:";
    func(c);
    Rectangle r(4.0, 5.0);
    cout<<"Rectangle çš„é¢ç§¯æ˜¯:";
    func(r);

    return 0;
}
```

## - è™šå‡½æ•°å’Œä¸€èˆ¬é‡è½½å‡½æ•°çš„åŒºåˆ«
- é‡è½½å‡½æ•°è¦æ±‚åå­—ç›¸åŒè€Œå‚æ•°ä¸åŒ, è™šå‡½æ•°è¦æ±‚å‡½æ•°åŸå‹å®Œå…¨ç›¸åŒ.
- é‡è½½å‡½æ•°å¯ä»¥æ˜¯æˆå‘˜å‡½æ•°æˆ–å‹å…ƒå‡½æ•°, è™šå‡½æ•°åªèƒ½æ˜¯éé™æ€å‡½æ•°.
- æ„é€ å‡½æ•°å¯ä»¥é‡è½½, ææ„å‡½æ•°ä¸èƒ½é‡è½½.è€Œæ„é€ å‡½æ•°ä¸èƒ½å®šä¹‰ä¸ºè™šå‡½æ•°, è€Œææ„å‡½æ•°å¯ä»¥.
- é‡è½½å‡½æ•°çš„è°ƒç”¨æ˜¯æ ¹æ®å‚æ•°åºåˆ—, è€Œè™šå‡½æ•°çš„è°ƒç”¨æ˜¯æ ¹æ®å¯¹è±¡çš„ä¸åŒ.
- é‡è½½å‡½æ•°åœ¨ç¼–è¯‘æ—¶è¡¨ç°å‡ºå¤šæ€æ€§, æ˜¯é™æ€è”ç¼–; è€Œè™šå‡½æ•°åˆ™åœ¨è¿è¡Œæ—¶è¡¨ç°å‡ºå¤šæ€æ€§, æ˜¯åŠ¨æ€è”ç¼–, å› æ­¤è¯´åŠ¨æ€è”ç¼–çš„æ˜¯ C++ çš„ç²¾é«“.

## - ç‰¹ç‚¹
- åŸºç±»ä¸­å®šä¹‰çš„è™šå‡½æ•°, é‚£ä¹ˆæ´¾ç”Ÿç±»ä¸­è¿™ä¸ªå‡½æ•°ä»ç„¶æ˜¯è™šå‡½æ•°, å› ä¸ºè™šå‡½æ•°å…·æœ‰è‡ªåŠ¨å‘ä¸‹ä¼ ç»™æ´¾ç”Ÿç±»çš„æ€§è´¨.
- åœ¨æ´¾ç”Ÿç±»ä¸­å¯ä»¥é‡æ–°å®šä¹‰è™šå‡½æ•°, è¦æ±‚å’ŒåŸºç±»çš„è™šå‡½æ•°çš„åŸå‹å®Œå…¨ç›¸åŒ, æ­¤æ—¶å…³é”®å­— virtual å¯ä»¥çœç•¥, ä½†ä¸ºäº†å¯è¯»æ€§, é€šå¸¸ä¸çœç•¥.
- ä¸ºåŒºåˆ†é‡è½½å‡½æ•°, é‡å®šä¹‰è™šå‡½æ•°å«åšè¦†ç›–.
- å¦‚æœæ´¾ç”Ÿç±»ä¸åŸºç±»çš„è™šå‡½æ•°**ä»…ä»…è¿”å›ç±»å‹ä¸åŒ**, C++ ä¼šè®¤ä¸ºä½¿ç”¨äº†ä¸æ°å½“çš„è™šå‡½æ•°, å› ä¸ºåªé è¿”å›ç±»å‹è¿›è¡Œå‡½æ•°åŒ¹é…æ˜¯æ¨¡ç³Šçš„.
- å¦‚æœæ´¾ç”Ÿç±»ä¸­ä¸åŸºç±»ä¸­çš„è™šå‡½æ•°**ä»…ä»…å½¢å‚ä¸åŒ**, é‚£ä¹ˆä¼šè¢«è®¤ä¸ºæ˜¯å®šä¹‰äº†å¦ä¸€ä¸ªè™šå‡½æ•°, è€Œä¸æ˜¯é‡æ–°å®šä¹‰åŸºç±»ä¸­çš„è™šå‡½æ•°, æ­¤æ—¶æ´¾ç”Ÿç±»ä¸­æœ‰ä¸¤ä¸ªè™šå‡½æ•°.
- æ´¾ç”Ÿç±»æŠŠåŸºç±»ä¸­çš„æ™®é€šå‡½æ•°é‡æ–°å®šä¹‰ä¸ºè™šå‡½æ•°, å¯¹åŸºç±»æ¯«æ— å½±å“.

# ä¸‰. æˆå‘˜å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°
ä¸€ä¸ªåŸºç±»æˆ–æ´¾ç”Ÿç±»çš„æˆå‘˜å‡½æ•°ä¸­å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥ç±»ç­‰çº§ä¸­çš„è™šå‡½æ•°.
(åœ¨è¿™ä¸ªğŸŒ°ä¸­, æ´¾ç”Ÿç±»ä¸­çš„func2 ä¸­è°ƒç”¨äº†è™šå‡½æ•° func1, è™½ç„¶ func2 ä¸æ˜¯è™šå‡½æ•°, é€šè¿‡åŸºç±»å¼•ç”¨è°ƒç”¨ func2, func2 è°ƒç”¨çš„æ˜¯æ´¾ç”Ÿç±»ä¸­çš„ func1. )
```c++
#include <iostream>

using namespace std;

/*
2017å¹´10æœˆ14æ—¥ 12:08:38
æˆå‘˜å‡½æ•°è°ƒç”¨è™šå‡½æ•°
*/

class Base
{
public:
    virtual void func1()
    {
        cout<<"è¿™æ˜¯çˆ¶ç±»çš„ func1 æ–¹æ³•."<<endl;
    }
    void func2() {func1();}
};


class Subclass: public Base
{
public:
    virtual void func1()
    {
        cout<<"è¿™æ˜¯å­ç±»çš„ func1 æ–¹æ³•"<<endl;
    }
};

int main()
{
    Subclass sc;
    // Base & bc = sc;
    // bc.func2();
    sc.func2();

    return 0;
}
```

# å››. æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°

æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­è°ƒç”¨çš„è™šå‡½æ•°æ˜¯è‡ªå·±çš„ç±»ä¸­å®šä¹‰çš„è™šå‡½æ•°(ä¹Ÿå°±æ˜¯è¯´åœ¨å½“å‰ç±»ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„), å¦‚æœè‡ªå·±çš„ç±»ä¸­æ²¡æœ‰è¿™ä¸ªè™šå‡½æ•°, åˆ™è°ƒç”¨åŸºç±»ä¸­çš„è™šå‡½æ•°, ä½†ç»ä¸æ˜¯ä»»ä½•åœ¨æ´¾ç”Ÿç±»ä¸­é‡å®šä¹‰(è¦†ç›–)çš„è™šå‡½æ•°.
```c++
#include <iostream>

using namespace std;

/*
2017å¹´10æœˆ14æ—¥ 12:22:20
æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°
è¾“å‡ºç»“æœ:
    è¿™æ˜¯çˆ¶ç±»çš„ func1 æ–¹æ³•.
    Exit main
    è¿™æ˜¯çˆ¶ç±»çš„ func2 æ–¹æ³•.
1. åœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°, è°ƒç”¨çš„æ˜¯ç±»ä¸­å®šä¹‰çš„è™šå‡½æ•°
   å¦‚æœæ²¡æœ‰å®šä¹‰, å°±è°ƒç”¨çˆ¶ç±»ä¸­çš„é‚£ä¸ªè™šå‡½æ•°.éœ€è¦æ³¨æ„çš„æ˜¯, å¦‚æœå½“å‰ç±»ä¸­è¦†ç›–äº†è™šå‡½æ•°,æ˜¯ä¸ä¼šè¢«è°ƒç”¨çš„.
*/


class Base
{
public:
    Base(){func1();}
    virtual void  func1()
    {
        cout<<"è¿™æ˜¯çˆ¶ç±»çš„ func1 æ–¹æ³•."<<endl;
    }
    virtual void  func2()
    {
        cout<<"è¿™æ˜¯çˆ¶ç±»çš„ func2 æ–¹æ³•."<<endl;
    }
    ~Base(){func2();}
};


class Subclass: public Base
{
public:
    virtual void func1()
    {
        cout<<"è¿™æ˜¯å­ç±»çš„ func1 æ–¹æ³•."<<endl;
    }
    virtual void  func2()
    {
        cout<<"è¿™æ˜¯å­ç±»çš„ func2 æ–¹æ³•."<<endl;
    }
};

int main()
{
    Subclass sc;

    cout<<"Exit main"<<endl;

    return 0;
}
```

# äº”. çº¯è™šå‡½æ•°å’ŒæŠ½è±¡ç±»
## - çº¯è™šå‡½æ•°
å¦‚æœåœ¨åŸºç±»ä¸­è¿˜ä¸ç¡®å®šä¸€ä¸ªè™šå‡½æ•°å…·ä½“èƒ½å¹²å˜›, å°±å¯ä»¥å°†å…¶å®šä¹‰ä¸ºçº¯è™šå‡½æ•°.
### æ ¼å¼
```c++
virtual <è¿”å›å€¼ç±»å‹><å‡½æ•°å>(<å½¢å¼å‚æ•°è¡¨>) = 0;
```
æ³¨æ„, è¿™é‡Œ = 0 åªæ˜¯ä¸€ç§å½¢å¼, è€Œä¸æ˜¯è¯´å®ƒçš„è¿”å›å€¼ç­‰äº 0 ;

### ğŸŒ°
```c++
#include <iostream>

const double PI = 3.14;

using namespace std;


/*
ä½¿ç”¨çº¯è™šå‡½æ•°
ä¸€èˆ¬å½¢å¼:
    virtual <è¿”å›å€¼ç±»å‹><å‡½æ•°å>(<å½¢å¼å‚æ•°è¡¨>) = 0;
*/


class Figure
{
public:
    Figure(){};
    virtual double area() = 0;    //å®šä¹‰ä¸ºçº¯è™šå‡½æ•°
};


class Circle: public Figure
{
public:
    Circle(double myr){R = myr;}
    virtual double area()
    {
        return PI*R*R;
    }
protected:
    double R;
};


class Rectangle: public Figure
{
public:
    Rectangle(double myl, double myw)
    {
        L = myl;
        W = myw;
    }
    virtual double area()
    {
        return L * W;
    }
private:
    double L, W;
};


void func(Figure &p)
{
    cout<<p.area()<<endl;
}


int main()
{
    Circle c(3.0);
    cout<<"Circle çš„é¢ç§¯æ˜¯: ";
    func(c);

    Rectangle r(4.0, 5.0);
    cout<<"Rectangle çš„é¢ç§¯æ˜¯:";
    func(r);

    return 0;
}
```

## æŠ½è±¡ç±»
- åªè¦åŒ…å«äº†çº¯è™šå‡½æ•°çš„ç±»å°±æ˜¯æŠ½è±¡ç±».
- æŠ½è±¡ç±»ä¸èƒ½çœ‹æˆæ˜¯ä¸€ç§ç±»å‹, æ‰€ä»¥ä¸èƒ½è¯´æ˜æŠ½è±¡ç±»çš„å¯¹è±¡, ä¸èƒ½ä½œä¸ºè¿”å›å€¼ç±»å‹, ä¸èƒ½ä½œä¸ºå½¢å¼å‚æ•°.
- å¯ä»¥è¯´æ˜æŠ½è±¡ç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨, ä»¥æ”¯æŒè¿è¡Œæ—¶çš„å¤šæ€æ€§.
- å¦‚æœè¦ç›´æ¥è°ƒç”¨æŠ½è±¡ç±»ä¸­å®šä¹‰çš„çº¯è™šå‡½æ•°, å¿…é¡»ä½¿ç”¨å®Œå…¨é™å®šå, å³ä½¿ç”¨å¸¦æœ‰ä½œç”¨åŸŸåˆ†è¾¨ç¬¦çš„å®Œå…¨é™å®šå‡½æ•°å???
- ä¸€ä¸ªæŠ½è±¡ç±»çš„æ´¾ç”Ÿç±», è¦ä¹ˆè¦†ç›–æ‰€æœ‰çš„çº¯è™šå‡½æ•°, ä½¿æ´¾ç”Ÿç±»ä¸æ˜¯æŠ½è±¡ç±», è¦ä¹ˆä»ç„¶å°†å…¶è¯´æ˜ä¸ºçº¯è™šå‡½æ•°, å¦åˆ™å°†ä¼šæŠ¥é”™.
- æˆå‘˜å‡½æ•°ä¸­å¯ä»¥è°ƒç”¨çº¯è™šå‡½æ•°, ä½†æ˜¯ä¸èƒ½åœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­è°ƒç”¨ä¸€ä¸ªçº¯è™šå‡½æ•°.

# å…­. è™šææ„å‡½æ•°
## å®šä¹‰
```c++
virtual ~<ç±»å>()
```
- ææ„å‡½æ•°æ²¡æœ‰è¿”å›å€¼å’Œå‚æ•°, æ‰€ä»¥åªèƒ½æœ‰ä¸€ä¸ª.
- C++ æ ‡å‡†ä¸æ”¯æŒè™šææ„å‡½æ•°.
- åŸºç±»çš„ææ„å‡½æ•°æ˜¯è™šå‡½æ•°, é‚£ä¹ˆæ‰€æœ‰æ´¾ç”Ÿç±»çš„ææ„å‡½æ•°éƒ½æ˜¯è™šå‡½æ•°.

## å¿…è¦æ€§
```c++
#include <iostream>

using namespace std;

/*
2017å¹´10æœˆ14æ—¥ 13:24:20
ææ„å‡½æ•°çš„å¿…è¦æ€§
å¦‚æœä¸å°†ææ„å‡½æ•°è®¾ä¸ºè™šå‡½æ•°, é‚£ä¹ˆ delete çš„æ—¶å€™ä¼šæ ¹æ®æŒ‡é’ˆçš„ç±»å‹è°ƒç”¨ææ„å‡½æ•°, è€Œä¸ä¼šè€ƒè™‘å¤šæ€æ€§
*/

class Base
{
public:
    Base(){};
    virtual ~Base()
    {
        cout<<"Base çš„ææ„å‡½æ•°è¢«è°ƒç”¨."<<endl;
    }
};


class Subclass: public Base
{
public:
    Subclass()
    {
        ptr = new int;
    }
    ~Subclass()
    {
        cout<<"Subclass çš„ææ„å‡½æ•°è¢«è°ƒç”¨."<<endl;
        delete ptr;
    }
private:
    int * ptr;
};

int main()
{
    Base * b = new Subclass;

    delete b;

    return 0;
}
```
å¦‚æœä¸ä½¿ç”¨è™šææ„å‡½æ•°, delete b çš„æ—¶å€™, ä¼šæ ¹æ® b çš„ç±»å‹è°ƒç”¨ Base çš„ææ„å‡½æ•°, è€Œä¸ä¼šè°ƒç”¨ Subclass çš„ææ„å‡½æ•°. 
å¦‚æœä½¿ç”¨è™šææ„å‡½æ•°, å…ˆè°ƒç”¨ Subclass çš„ææ„å‡½æ•°, åœ¨è°ƒç”¨ Base çš„ææ„å‡½æ•°, æ‰€ä»¥è™šææ„å‡½æ•°æ˜¯å¿…è¦çš„.
